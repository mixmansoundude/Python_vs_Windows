```diff
diff --git a/run_setup.bat b/run_setup.bat
index 86b0148..703103a 100644
--- a/run_setup.bat
+++ b/run_setup.bat
@@ -23,6 +23,13 @@ call :rotate_log
 rem HP_* variables represent "Helper Payload" assets emitted on demand.
 call :define_helper_payloads
 for %%I in ("%CD%") do set "ENVNAME=%%~nI"
+rem derived requirement: conda env names reject characters like '~'; self env smoke
+rem scenarios run from tests\~envsmoke so normalize to ASCII word chars/_/-.
+set "ENVNAME_SANITIZED="
+for /f "usebackq delims=" %%I in (`powershell -NoProfile -ExecutionPolicy Bypass -Command "$name = $env:ENVNAME; if (-not $name) { $name = 'env'; } $san = ($name -replace '[^A-Za-z0-9_-]', '_'); if ([string]::IsNullOrWhiteSpace($san) -or ($san.Trim('_').Length -eq 0)) { $san = 'env'; } Write-Output $san"` ) do set "ENVNAME_SANITIZED=%%I"
+if defined ENVNAME_SANITIZED set "ENVNAME=%ENVNAME_SANITIZED%"
+set "ENVNAME_SANITIZED="
+
 
 set "PYCOUNT=0"
 for /f "delims=" %%F in ('dir /b /a-d *.py 2^>nul') do call :count_python "%%F"
```